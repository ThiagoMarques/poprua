<div class="container container-psr">
  <div class="row">
    <div class="col-sm-12">
      <div class="row justify-content-center">
        <span class="page-psr pt-1 pb-1">Página <span id="page-now"></span></span>
      </div>
      <div class="row card">
        <div class="col-sm-12">
          <div class="row ">
            <div class="col-sm-12 card box-text">
              <div id="informativo" class="row informativo-col">
                <div class="col-sm-6">
                  <div class="row">
                    <div class="informativo-texto pb-0">
                      <h1 class="informativo-bold">Vamos consolidar o que estudamos?</h1>
                      <p>A seguir vamos fazer <span class="highlight">exercícios</span> sobre os assuntos relacionadas aos conteúdos estudados.</p>
                      <p>Orientações para responder os <span class="highlight">exercícios</span>:</p>
                      <ul>
                        <li><span class="number">1.</span><span class="highlight">Clique</span> na opção correta. Aparecerá o feedback dessa questão.</li>
                        <li><span class="number">2.</span>Se a <b>resposta estiver incorreta</b>, é possível fechar o feedback e tentar novamente.</li>
                        <li><span class="number">3.</span>Não há limites de tentativas</li>
                      </ul>
                    </div>
                  </div>
                  <div class="row text-center btn-text">
                    <button class="btn btn-lg btnStart" onclick="show('questoes')">Iniciar</button>
                  </div>
                </div>
                <div class="col-sm-6">
                  <img src="img/exercicios.png" class="img-fluid d-none d-sm-block" alt="imagem de um livro" srcset="">
                </div>
              </div>
              <div id="questoes" class="row row-exercise">
                <div class="col-sm-12">
                  <h3 id="enunciate">Enunciado</h3>
                  <h3 id="question">Pergunta</h3>
                  <div id="optA" class="choice-container">
                    <p class="choice-prefix">(a)</p>
                    <p class="choice-text" data-number="1">Pergunta 1</p>
                  </div>
                  <div id="feedbackA" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                  <div id="optB" class="choice-container">
                    <p class="choice-prefix">(b)</p>
                    <p class="choice-text" data-number="2">Pergunta 2</p>
                  </div>
                  <div id="feedbackB" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                  <div id="optC" class="choice-container">
                    <p class="choice-prefix">(c)</p>
                    <p class="choice-text" data-number="3">Pergunta 3</p>
                  </div>
                  <div id="feedbackC" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                  <div id="optD" class="choice-container">
                    <p class="choice-prefix">(d)</p>
                    <p class="choice-text" data-number="4">Pergunta 4</p>
                  </div>
                  <div id="feedbackD" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                  <div id="optE" class="choice-container">
                    <p class="choice-prefix">(e)</p>
                    <p class="choice-text" data-number="5">Pergunta 5</p>
                  </div>
                  <div id="feedbackE" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                </div>
                <input id="btnResposta" type="button" value="finalizar" onclick="changeWindow();">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>  
  <div class="stepBack" onclick="stepNavigation('c' + stepBackNumber);">
    <i class="fas fa-chevron-left mb-4"></i>
    <span class="stepText">voltar</span>
  </div>
  <div class="stepForward" onclick="stepNavigation('c' + stepForwardNumber);">
    <i class="fas fa-chevron-right mb-4"></i>
    <span class="stepText">avançar</span>
  </div>
  <div class="modal fade" id="feedbackModal" tabindex="-1" role="dialog" aria-labelledby="tituloModal"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="tituloModal"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="texto-modal" class="modal-body">
      </div>
    </div>
  </div>
</div>
</div>
  
<script>
  var enunciate = document.querySelector('#enunciate')
  var question = document.querySelector('#question')
  var choices = Array.from(document.querySelectorAll('.choice-text'))
  var progressText = document.querySelector('#progressText')
  var progressBarFull = document.querySelector('#progressBarFull')

  var currentQuestion = {}
  var acceptingAnswers = true
  var score = 0
  var questionCounter = 0
  var availableQuestions = []

  var questions = [
    {
      type: 'ME',
      enunciate: 'Marque uma das opções abaixo:',
      question: 'Considerando  as principais características e especificidades da Pessoal em Situação de rua, assinale a alternativa correta:',
      choice1: 'Pequenos municípios não precisam de políticas públicas voltadas para a PSR, pois essa população se concentra nos grandes centros urbanos.',
      choice2: 'A PSR se encontra nessa situação porque não trabalha, tem conflito familiar, usa drogas ou álcool, tem transtorno mental ou porque opta por levar esse estilo de vida.',
      choice3: 'Nas grandes cidades, as políticas de remoção compulsória das PSRs e de seus bens, ofertando tratamento aos dependentes e doentes mentais, são mais resolutivas que a redução de danos.',
      choice4: 'O cadastro do cidadão disponível no e-SUS tem grande potencial de servir de parâmetro populacional oficial para a PSR, de maneira conjugada à ampliação do conhecimento acerca do perfil desse público.',
      choice5: 'A PSR não reverbera nem reproduz os estigmas e preconceitos em suas relações com os outros e consigo mesma.',
      answer: 4,
      feedback1: 'Embora esteja claro que o fenômeno segue apresentando características eminentemente urbanas, observa-se que, em 2020, 18,5% do povo da rua estão em municípios pequenos ou médios, indicando a necessidade de se pensar em políticas públicas adequadas a essas localidades. (Natalino, 2020).',
      feedback2: 'Embora as pesquisas em campo mostrem essas como as principais razões relatadas para a permanência na rua, a taxa de crescimento mais intenso nos grandes municípios sugere que a crise econômica e, em particular, o aumento do desemprego e da pobreza sejam fatores importantes para a explicação do ocorrido. A lógica da rua segue o processo de urbanização, da concentração de riquezas de um local, das intervenções conjuntas do Estado e da sociedade civil no fenômeno e, principalmente, do número de habitantes. (MDS, 2008; Natalino, 2016, 2020).',
      feedback3: 'O que determina a concentração de PSR em um local é o fenômeno da urbanização e da concentração de riquezas no local e as relações sociais precárias dessa população. Ações desconectadas desse processo apenas agravam a exposição desse grupo a mais situações de violência e de exploração e a evocações de traumas passados.',
      feedback4: 'Embora atualmente o censo decenal do IBGE, de nível nacional, não tenha incluído a PSR e as maiores fontes de estimativa populacional oficiais da PSR venham de dados municipais (por meio dos cadastros do Sistema Único de Assistência Social - SUAS ou de iniciativas de governos locais), a Atenção Básica possui grande capilaridade territorial através da ESF, com abrangência nacional e universal.',
      feedback5: 'Seria ingenuidade achar que os discursos dos informantes, nas pesquisas censitárias sobre a PSR, são autoevidentes. Como parte desprivilegiada, o cidadão em situação de rua não está isento da dominação de suas subjetividades pela sociedade. Pelo contrário, a PSR é peça-chave na sua reprodução, e seus discursos devem ser contextualizados com o fenômeno da identidade do sujeito como fruto do meio social (Rodrigues & Fernandes, 2020).',
    }
  ]

  var SCORE_POINTS = 1
  var MAX_QUESTIONS = 1
  var moduleExercise = 'EX1'
  var numberPage = 21

  startQuestions = () => {
    questionCounter = 0
    score = 0
    availableQuestions = [...questions]
    getNewQuestion()
    $('#btnResposta').hide()
    $('#informativo').removeClass('informativo-col')
  }
  getNewQuestion = () => {
    if (availableQuestions.length === 0 || questionCounter >= MAX_QUESTIONS) {
      feedbackUser()
      show('resultado')

    } else {
      questionCounter++
      clearAtributes()
      var questionsIndex = Math.floor(Math.random() * availableQuestions.length)
      currentQuestion = availableQuestions[questionsIndex]

      if (currentQuestion.type === 'ME') {
        enunciate.innerText = currentQuestion.enunciate
        question.innerText = currentQuestion.question

        choices.forEach(choice => {
          var number = choice.dataset['number']
          choice.innerText = currentQuestion['choice' + number]
        })
      }
      if (currentQuestion.type === 'VF') {
        enunciate.innerText = currentQuestion.enunciate
        question.innerText = currentQuestion.question

        choices.forEach(choice => {
          var number = choice.dataset['number']
          choice.innerText = currentQuestion['choice' + number]

          $("#optC").hide()
          $("#optD").hide()
          $("#optE").hide()
        })
      }
      availableQuestions.splice(questionsIndex, 1)
      acceptingAnswers = true
    }
  }

  clearAtributes = () => {
    $("#optC").show()
    $("#optD").show()
    $("#optE").show()

    $("#btnResposta").prop("disabled", true)

    $('.div-feedback').removeClass('correta')
    $('.div-feedback').removeClass('incorreta')

    choices.forEach(choice => {
      choice.parentElement.classList.remove('correct')
      choice.parentElement.classList.remove('incorrect')
    })

    var all = $(".choiced-container").map(function () {
      this.classList.remove('choiced-container')
      this.classList.add('choice-container')
    })
  }

  clearQuestion = () => {
    acceptingAnswers = true
  }

  choices.forEach(choice => {
    choice.addEventListener('click', e => {
      if (!acceptingAnswers) return

      acceptingAnswers = false
      var selectedChoice = e.target
      var selectedAnswer = selectedChoice.dataset['number']
      var numQuestion = parseInt(selectedAnswer)
      var elementFeedback = ''

      switch (numQuestion) {
        case 1:
          $('.feedback-text').html(currentQuestion.feedback1)
          $('#feedbackA').show()
          break
        case 2:
          $('.feedback-text').html(currentQuestion.feedback2)
          $('#feedbackB').show()
          break
        case 3:
          $('.feedback-text').html(currentQuestion.feedback3)
          $('#feedbackC').show()
          break
        case 4:
          $('.feedback-text').html(currentQuestion.feedback4)
          $('#feedbackD').show()
          break
        case 5:
          $('.feedback-text').html(currentQuestion.feedback5)
          $('#feedbackE').show()
          break
      }
      var questao = document.getElementById(elementFeedback)
      $("#btnResposta").prop("disabled", false)

      var classToApply = selectedAnswer == currentQuestion.answer ? 'correct' : 'incorrect'

      if (classToApply === 'correct') {
        incrementScore(SCORE_POINTS)
        $(".div-feedback").addClass('correta')
        $('.feedback-titulo').html('Resposta correta')
        $('.feedback-titulo').css('color', '#009900')
        $('#btnResposta').show()
        $('.btn-feedback').hide()
        $('#btn-nav').prop('disabled', false)
      } else {
        $(".div-feedback").addClass('incorreta')
        $('.feedback-titulo').html('Resposta incorreta')
        $('.feedback-titulo').css('color', '#e60000')
      }

      selectedChoice.parentElement.classList.add(classToApply)

      var all = $(".choice-container").map(function () {
        this.classList.remove('choice-container')
        this.classList.add('choiced-container')
      })
      if (questionCounter > MAX_QUESTIONS - 1)
        $("#btnResposta").prop('value', 'Finalizar')
    })
  })

  incrementScore = num => {
    score += num
    updateExer(moduleExercise, numberPage)
  }

  function show(elementID) {
    switch (elementID) {
      case 'informativo':
        $("#questoes").hide()
        break

      case 'questoes':
        $("#informativo").hide()
        startQuestions()
        break;

      case 'resultado':
        $("#informativo").hide()
        $("#questoes").hide()
        break;
    }

    var questao = document.getElementById(elementID)
    if (!questao) {
      return;
    }

    var pages = document.getElementsByClassName('questao')
    for (var i = 0; i < pages.length; i++) {
      pages[i].style.display = 'none';
    }
    questao.style.display = 'block';
  }
  function changeWindow() {
    stepNavigation(('c' + stepForwardNumber))
  }

  function closeFeedback() {
    $("#optC").show()
    $("#optD").show()
    $("#optE").show()

    $("#btnResposta").prop("disabled", true)

    $('.div-feedback').removeClass('correta')
    $('.div-feedback').removeClass('incorreta')

    $("#feedbackA").hide()
    $("#feedbackB").hide()
    $("#feedbackC").hide()
    $("#feedbackD").hide()
    $("#feedbackE").hide()

    acceptingAnswers = true


    choices.forEach(choice => {
      choice.parentElement.classList.remove('correct')
      choice.parentElement.classList.remove('incorrect')
    })

    var all = $(".choiced-container").map(function () {
      this.classList.remove('choiced-container')
      this.classList.add('choice-container')
    })
  }

  $(document).ready(function () {
    clearAtributes();
    show('informativo');
    $('#bar-index').hide();
    $('#btn-nav').prop('disabled', true);
  });
</script>