<div class="container container-psr">
  <div class="row">
    <div class="col-sm-12">
      <div class="row justify-content-center">
        <span class="page-psr pt-1 pb-1">Página <span id="page-now"></span></span>
      </div>
      <div class="row card">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-12 card box-text">
              <div id="informativo" class="row informativo-col">
                <div class="col-sm-6">
                  <div class="row">
                    <div class="informativo-texto pb-0">
                      <h1 class="informativo-bold">Vamos consolidar o que estudamos?</h1>
                      <p>A seguir vamos fazer <span class="highlight">exercícios</span> sobre os assuntos relacionadas aos conteúdos estudados.</p>
                      <p>Orientações para responder os <span class="highlight">exercícios</span>:</p>
                      <ul>
                        <li><span class="number">1.</span><span class="highlight">Clique</span> na opção correta. Aparecerá o feedback dessa questão.</li>
                        <li><span class="number">2.</span>Se a <b>resposta estiver incorreta</b>, é possível fechar o feedback e tentar novamente.</li>
                        <li><span class="number">3.</span>Não há limites de tentativas</li>
                      </ul>
                    </div>
                  </div>
                  <div class="row text-center btn-text">
                    <button class="btn btn-lg btnStart" onclick="show('questoes')">Iniciar</button>
                  </div>
                </div>
                <div class="col-sm-6">
                  <img src="img/exercicios.png" class="img-fluid d-none d-sm-block" alt="imagem de um livro" srcset="">
                </div>
              </div>
              <div id="questoes" class="row row-exercise">
                <div class="col-sm-12">
                  <h3 id="enunciate">Enunciado</h3>
                  <h3 id="question">Pergunta</h3>
                  <div id="optA" class="choice-container">
                    <p class="choice-prefix">(a)</p>
                    <p class="choice-text" data-number="1">Pergunta 1</p>
                  </div>
                  <div id="feedbackA" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                  <div id="optB" class="choice-container">
                    <p class="choice-prefix">(b)</p>
                    <p class="choice-text" data-number="2">Pergunta 2</p>
                  </div>
                  <div id="feedbackB" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                  <div id="optC" class="choice-container">
                    <p class="choice-prefix">(c)</p>
                    <p class="choice-text" data-number="3">Pergunta 3</p>
                  </div>
                  <div id="feedbackC" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                  <div id="optD" class="choice-container">
                    <p class="choice-prefix">(d)</p>
                    <p class="choice-text" data-number="4">Pergunta 4</p>
                  </div>
                  <div id="feedbackD" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                  <div id="optE" class="choice-container">
                    <p class="choice-prefix">(e)</p>
                    <p class="choice-text" data-number="5">Pergunta 5</p>
                  </div>
                  <div id="feedbackE" class="div-feedback">
                    <div class="row justify-content-between">
                      <p class="feedback-titulo">FeedbackTitulo</p>
                      <i onclick="closeFeedback()" class="fa fa-times btn-feedback" aria-hidden="true"></i>
                    </div>
                    <div class="row">
                      <p class="feedback-text">FeedbackTexto</p>
                    </div>
                  </div>
                </div>
                <input id="btnResposta" type="button" value="finalizar" onclick="changeWindow();">
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>  
  <div class="stepBack" onclick="stepNavigation('c' + stepBackNumber);">
    <i class="fas fa-chevron-left mb-4"></i>
    <span class="stepText">voltar</span>
  </div>
  <div class="stepForward" onclick="stepNavigation('c' + stepForwardNumber);">
    <i class="fas fa-chevron-right mb-4"></i>
    <span class="stepText">avançar</span>
  </div>
  <div class="modal fade" id="feedbackModal" tabindex="-1" role="dialog" aria-labelledby="tituloModal"
  aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="tituloModal"></h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div id="texto-modal" class="modal-body">
      </div>
    </div>
  </div>
</div>
</div>
  
<script>
  var enunciate = document.querySelector('#enunciate')
  var question = document.querySelector('#question')
  var choices = Array.from(document.querySelectorAll('.choice-text'))
  var progressText = document.querySelector('#progressText')
  var progressBarFull = document.querySelector('#progressBarFull')

  var currentQuestion = {}
  var acceptingAnswers = true
  var score = 0
  var questionCounter = 0
  var availableQuestions = []

  var questions = [
    {
      type: 'ME',
      enunciate: 'Marque uma das opções abaixo:',
      question: 'Como organizar a demanda de atendimento da população em situação de rua do seu território levando em consideração suas características, histórias de vida e necessidades de cuidado?',
      choice1: 'A população em situação de rua deverá ser atendida prioritariamente em demanda espontânea na UBS, já que ela não tem “paciência” para aguardar uma consulta agendada.',
      choice2: 'A população em situação de rua deverá ser atendida prioritariamente por meio de consultas agendadas, com horários bem definidos, como a população domiciliada do território.',
      choice3: 'A população em situação de rua deverá ser atendida sempre pela equipe de referência de seu território, caso a equipe não possa acolhê-la no momento de busca por atendimento, deverá agendar consulta e retornar no dia agendado.',
      choice4: 'A população em situação de rua não poderá aguardar por atendimento na Unidade de Saúde, devendo ser atendida no momento de sua chegada, já que são violentos e agressivos e que isso pode causar “tumultos” para outros pacientes que aguardam pelo atendimento.',
      choice5: 'A população em situação, como a população domiciliada, deverá ser acolhida ao chegar no serviço de saúde, tendo suas demandas escutadas e direcionadas, para atendimento imediato não agendado, agendamento breve ou consulta de rotina, levando-se em conta sua dinâmica de vida e necessidades de cuidado.',
      answer: 5,
      feedback1: 'Os indivíduos em situação de rua, como os demais indivíduos que procuram o serviço de saúde, possuem as mais diversas demandas e necessidades de cuidado, devem ser acolhidos e compreendidos para que sejam orientados sobre os tempos de atendimento, por meio da classificação de risco e do direcionamento para os cuidados dentro da unidade.',
      feedback2: 'Para o atendimento da população em situação de rua, deverão ser levados em conta sua dinâmica de vida, horários que fazem suas alimentações, horários que buscam vagas para acolhimento. Assim, deverá haver possibilidades de dias e horários variados para os agendamentos de suas consultas programadas.',
      feedback3: 'A população em situação de rua que procura o serviço de saúde deverá ser acolhida por profissional, com escuta atenta para suas demandas de saúde, avaliando a necessidade de atendimento no dia ou não. A ausência ou impossibilidade de atendimento por parte da equipe de referência  do território de “moradia” daquele indivíduo não poderá ser um impedimento /dificuldade para seu atendimento.',
      feedback4: 'A população em situação  de rua, ao ser acolhida, terá condições de entender sobre o que consiste a classificação de risco, bem como quais as possibilidades de atendimento do serviço de saúde. Por vezes, essa população tem comportamentos agressivos, por terem sofrido violações de direitos, inclusive em saúde,  como terem sido discriminadas em serviços de saúde, por sua condição de higiene. Assim, é importante que seja acolhida para que suas demandas sejam respeitosamente ouvidas e direcionadas.',
      feedback5: 'O acolhimento e a escuta atenta devem ser sempre utilizados para definir os “caminhos” e fluxos de atendimento para a população que procura o serviço de saúde.',
    }
  ]

  var SCORE_POINTS = 1
  var MAX_QUESTIONS = 1
  var moduleExercise = 'EX2'
  var numberPage = 46

  startQuestions = () => {
    questionCounter = 0
    score = 0
    availableQuestions = [...questions]
    getNewQuestion()
    $('#btnResposta').hide()
    $('#informativo').removeClass('informativo-col')
  }
  getNewQuestion = () => {
    if (availableQuestions.length === 0 || questionCounter >= MAX_QUESTIONS) {
      feedbackUser()
      show('resultado')

    } else {
      questionCounter++
      clearAtributes()
      var questionsIndex = Math.floor(Math.random() * availableQuestions.length)
      currentQuestion = availableQuestions[questionsIndex]

      if (currentQuestion.type === 'ME') {
        enunciate.innerText = currentQuestion.enunciate
        question.innerText = currentQuestion.question

        choices.forEach(choice => {
          var number = choice.dataset['number']
          choice.innerText = currentQuestion['choice' + number]
        })
      }
      if (currentQuestion.type === 'VF') {
        enunciate.innerText = currentQuestion.enunciate
        question.innerText = currentQuestion.question

        choices.forEach(choice => {
          var number = choice.dataset['number']
          choice.innerText = currentQuestion['choice' + number]

          $("#optC").hide()
          $("#optD").hide()
          $("#optE").hide()
        })
      }
      availableQuestions.splice(questionsIndex, 1)
      acceptingAnswers = true
    }
  }

  clearAtributes = () => {
    $("#optC").show()
    $("#optD").show()
    $("#optE").show()

    $("#btnResposta").prop("disabled", true)

    $('.div-feedback').removeClass('correta')
    $('.div-feedback').removeClass('incorreta')

    choices.forEach(choice => {
      choice.parentElement.classList.remove('correct')
      choice.parentElement.classList.remove('incorrect')
    })

    var all = $(".choiced-container").map(function () {
      this.classList.remove('choiced-container')
      this.classList.add('choice-container')
    })
  }

  clearQuestion = () => {
    acceptingAnswers = true
  }

  choices.forEach(choice => {
    choice.addEventListener('click', e => {
      if (!acceptingAnswers) return

      acceptingAnswers = false
      var selectedChoice = e.target
      var selectedAnswer = selectedChoice.dataset['number']
      var numQuestion = parseInt(selectedAnswer)
      var elementFeedback = ''

      switch (numQuestion) {
        case 1:
          $('.feedback-text').html(currentQuestion.feedback1)
          $('#feedbackA').show()
          break
        case 2:
          $('.feedback-text').html(currentQuestion.feedback2)
          $('#feedbackB').show()
          break
        case 3:
          $('.feedback-text').html(currentQuestion.feedback3)
          $('#feedbackC').show()
          break
        case 4:
          $('.feedback-text').html(currentQuestion.feedback4)
          $('#feedbackD').show()
          break
        case 5:
          $('.feedback-text').html(currentQuestion.feedback5)
          $('#feedbackE').show()
          break
      }
      var questao = document.getElementById(elementFeedback)
      $("#btnResposta").prop("disabled", false)

      var classToApply = selectedAnswer == currentQuestion.answer ? 'correct' : 'incorrect'

      if (classToApply === 'correct') {
        incrementScore(SCORE_POINTS)
        $(".div-feedback").addClass('correta')
        $('.feedback-titulo').html('Resposta correta')
        $('.feedback-titulo').css('color', '#009900')
        $('#btnResposta').show()
        $('.btn-feedback').hide()
        $('#btn-nav').prop('disabled', false)
        
      } else {
        $(".div-feedback").addClass('incorreta')
        $('.feedback-titulo').html('Resposta incorreta')
        $('.feedback-titulo').css('color', '#e60000')
      }

      selectedChoice.parentElement.classList.add(classToApply)

      var all = $(".choice-container").map(function () {
        this.classList.remove('choice-container')
        this.classList.add('choiced-container')
      })
      if (questionCounter > MAX_QUESTIONS - 1)
        $("#btnResposta").prop('value', 'Finalizar')
    })
  })

  incrementScore = num => {
    score += num
    updateExer(moduleExercise, numberPage)
  }

  function show(elementID) {
    switch (elementID) {
      case 'informativo':
        $("#questoes").hide()
        break

      case 'questoes':
        $("#informativo").hide()
        startQuestions()
        break;

      case 'resultado':
        $("#informativo").hide()
        $("#questoes").hide()
        break;
    }

    var questao = document.getElementById(elementID)
    if (!questao) {
      return;
    }

    var pages = document.getElementsByClassName('questao')
    for (var i = 0; i < pages.length; i++) {
      pages[i].style.display = 'none';
    }
    questao.style.display = 'block';
  }
  function changeWindow() {
    stepNavigation(('c' + stepForwardNumber))
  }

  function closeFeedback() {
    $("#optC").show()
    $("#optD").show()
    $("#optE").show()

    $("#btnResposta").prop("disabled", true)

    $('.div-feedback').removeClass('correta')
    $('.div-feedback').removeClass('incorreta')

    $("#feedbackA").hide()
    $("#feedbackB").hide()
    $("#feedbackC").hide()
    $("#feedbackD").hide()
    $("#feedbackE").hide()

    acceptingAnswers = true


    choices.forEach(choice => {
      choice.parentElement.classList.remove('correct')
      choice.parentElement.classList.remove('incorrect')
    })

    var all = $(".choiced-container").map(function () {
      this.classList.remove('choiced-container')
      this.classList.add('choice-container')
    })
  }

  $(document).ready(function () {
    clearAtributes();
    show('informativo');
    $('#bar-index').hide();
    $('#btn-nav').prop('disabled', true);
  });

</script>